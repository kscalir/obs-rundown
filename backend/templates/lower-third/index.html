<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
      font-family: Arial, sans-serif;
    }
    
    /* Force exact 16:9 aspect ratio at any size */
    .canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100vw;
      height: 56.25vw; /* 16:9 ratio: 9/16 * 100 = 56.25 */
      max-height: 100vh;
      max-width: 177.78vh; /* 16:9 ratio: 16/9 * 100 = 177.78 */
      background: #333;
      background-image: 
        linear-gradient(45deg, #444 25%, transparent 25%), 
        linear-gradient(-45deg, #444 25%, transparent 25%), 
        linear-gradient(45deg, transparent 75%, #444 75%), 
        linear-gradient(-45deg, transparent 75%, #444 75%);
      background-size: 20px 20px;
      background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
    }
    
    /* Position the canvas centered if viewport is not exactly 16:9 */
    .canvas {
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
    }
    
    .lower-third { 
      position: absolute; 
      bottom: 8%;
      left: 4%;
      background: var(--color, #1976d2); 
      color: white; 
      padding: 1.5% 2.5%;
      border-radius: 0.5%;
      box-shadow: 0 0.3% 0.8% rgba(0,0,0,0.4);
      max-width: 35%;
      min-width: 20%;
      opacity: 1;
      transform: translateX(0);
      transition: all 0.3s ease;
    }
    
    .lower-third.hidden { 
      opacity: 0;
      transform: translateX(-50%);
    }
    
    .name { 
      font-size: 1.8vw; /* Scale with viewport width */
      font-weight: bold; 
      margin-bottom: 0.3vw; 
      line-height: 1.2;
      /* Remove single-line constraints */
      word-wrap: break-word;
      overflow-wrap: break-word;
      max-height: 2.4em; /* Allow for 2 lines */
      overflow: hidden;
    }
    
    .title { 
      font-size: 1.3vw; /* Scale with viewport width */
      opacity: 0.95; 
      line-height: 1.2;
      /* Remove single-line constraints */
      word-wrap: break-word;
      overflow-wrap: break-word;
      max-height: 2.4em; /* Allow for 2 lines */
      overflow: hidden;
    }
    
    /* Minimum sizes for very small previews */
    @media (max-width: 400px) {
      .name { 
        font-size: 8px;
      }
      .title { 
        font-size: 6px;
      }
      .lower-third {
        padding: 4px 6px;
        border-radius: 2px;
      }
    }
  </style>
</head>
<body>
  <div class="canvas">
    <div class="lower-third" id="container">
      <div class="name" id="nameField">Name</div>
      <div class="title" id="titleField">Title</div>
    </div>
  </div>
  
  <script>
    console.log('Template: loaded and ready');
    
    function updateFields(data) {
      console.log('Template: data received', data);
      
      const nameField = document.getElementById('nameField');
      const titleField = document.getElementById('titleField');
      
      if (nameField) nameField.textContent = data.f0 || data.name || 'Name';
      if (titleField) titleField.textContent = data.f1 || data.title || 'Title';
      
      if (data.color) {
        document.documentElement.style.setProperty('--color', data.color);
      }
    }
    
    // Handle postMessage from parent window (for preview)
    window.addEventListener('message', function(event) {
      console.log('Template: message received', event.data);
      if (event.data && typeof event.data === 'object') {
        updateFields(event.data);
      }
    });
    
    // Parse URL parameters on load
    function parseUrlParams() {
      const urlParams = new URLSearchParams(window.location.search);
      const dataParam = urlParams.get('data');
      if (dataParam) {
        try {
          const data = JSON.parse(decodeURIComponent(dataParam));
          console.log('Template: URL data parsed', data);
          updateFields(data);
        } catch (err) {
          console.error('Template: Error parsing URL data', err);
        }
      }
    }
    
    // Initialize on load
    parseUrlParams();
    
    // Animation functions for play/stop
    function play() {
      console.log('Template: play');
      const container = document.getElementById('container');
      if (container) {
        container.classList.remove('hidden');
      }
    }
    
    function stop() {
      console.log('Template: stop');
      const container = document.getElementById('container');
      if (container) {
        container.classList.add('hidden');
      }
    }
    
    function update(data) {
      console.log('Template: update', data);
      if (data) updateFields(data);
    }
    
    // Make functions globally available
    window.play = play;
    window.stop = stop;
    window.update = update;
  </script>
</body>
</html>